#!/usr/bin/env python3

import json
import pandas as pd
from pathlib import Path

# ---------------------------------------
# CONFIG â€” EDIT THIS ONLY IF YOU CHANGE REPO PATHS
# ---------------------------------------
LOG_FILE = "alert_log.jsonl"     # we will download this into repo later

def load_jsonl(file_path):
    data = []
    with open(file_path, "r") as f:
        for line in f:
            try:
                data.append(json.loads(line))
            except:
                pass
    return data

def main():
    print("\nğŸ” Pingr ML Tracker Starting...\n")

    file_path = Path(LOG_FILE)
    if not file_path.exists():
        print(f"âŒ ERROR: {LOG_FILE} not found in this folder.")
        print("â¡ï¸  Please place alert_log.jsonl in the repo root.")
        return

    print(f"ğŸ“ Reading: {LOG_FILE}")
    raw = load_jsonl(file_path)

    if not raw:
        print("âš ï¸ File is empty or unreadable.")
        return

    df = pd.DataFrame(raw)
    print(f"ğŸ“¦ Loaded {len(df)} entries")

    # Clean fields
    df["timestamp"] = pd.to_datetime(df["timestamp"], errors="coerce")

    numeric_cols = ["rsi_15m", "signal_score", "heat_index"]
    for col in numeric_cols:
        if col in df:
            df[col] = pd.to_numeric(df[col], errors="coerce")

    print("\nğŸ“Š --- HIGH LEVEL SUMMARY ---")
    print(f"Total rows: {len(df)}")
    print("Alerts Sent:", df[df["alert_sent"] == True].shape[0])

    # Save CSV if needed
    df.to_csv("pingr_cleaned_data.csv", index=False)
    print("\nğŸ’¾ Saved pingr_cleaned_data.csv")

    print("\nğŸ‰ Done! You can now analyze the logs safely here.")

if __name__ == "__main__":
    main()
